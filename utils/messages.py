"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞.
–°–æ–¥–µ—Ä–∂–∏—Ç —à–∞–±–ª–æ–Ω—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
"""

from typing import Optional, Dict, List
from datetime import datetime


def format_user_status(user: Optional[Dict]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    Args:
        user: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ None
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    """
    if not user:
        return "‚ùå –ù–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
    
    return (
        f"‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω\n"
        f"üìß Email: <code>{user.get('email', 'N/A')}</code>\n"
        f"üè¢ –ü—Ä–æ–≤–∞–π–¥–µ—Ä: {user.get('email_provider', 'N/A')}"
    )


def format_permissions_count(permissions: Dict[str, List[Dict]]) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.
    
    Args:
        permissions: –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏ 'given' –∏ 'received'
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ö
    """
    given_count = len(permissions.get('given', []))
    received_count = len(permissions.get('received', []))
    
    return (
        f"üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:</b>\n"
        f"‚úÖ –î–∞–ª –¥–æ—Å—Ç—É–ø: {given_count} —á–µ–ª.\n"
        f"üì• –ü–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø: {received_count} —á–µ–ª."
    )


def format_code_result(
    code: str,
    owner_username: str,
    owner_email: str,
    search_time: Optional[float] = None
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞.
    
    Args:
        code: –ù–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–¥
        owner_username: Username –≤–ª–∞–¥–µ–ª—å—Ü–∞
        owner_email: Email –≤–ª–∞–¥–µ–ª—å—Ü–∞
        search_time: –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    message = (
        f"‚úÖ <b>–ö–æ–¥ –Ω–∞–π–¥–µ–Ω!</b>\n\n"
        f"üîê –ö–æ–¥: <code>{code}</code>\n\n"
        f"üë§ –û—Ç: @{owner_username}\n"
        f"üìß –ü–æ—á—Ç–∞: {owner_email}\n\n"
        f"üí° –ù–∞–∂–º–∏ –Ω–∞ –∫–æ–¥ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"
    )
    
    if search_time:
        message += f"\n\n‚è± –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞: {search_time:.1f} —Å–µ–∫."
    
    return message


def format_code_not_found(
    owner_username: str,
    suggestions: Optional[List[str]] = None
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω.
    
    Args:
        owner_username: Username –≤–ª–∞–¥–µ–ª—å—Ü–∞
        suggestions: –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    message = (
        f"üòû <b>–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</b>\n\n"
        f"–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
        f"‚Ä¢ –í –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–∏—Å—å–º–∞—Ö –Ω–µ—Ç 2FA –∫–æ–¥–æ–≤\n"
        f"‚Ä¢ –ö–æ–¥—ã —Å—Ç–∞—Ä—à–µ 10 –º–∏–Ω—É—Ç (—É—Å—Ç–∞—Ä–µ–ª–∏)\n"
        f"‚Ä¢ –ü–∏—Å—å–º–∞ —Å –∫–æ–¥–æ–º –µ—â—ë –Ω–µ –ø—Ä–∏—à–ª–∏\n\n"
        f"üí° –ü–æ–ø—Ä–æ–±—É–π:\n"
        f"‚Ä¢ –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥\n"
        f"‚Ä¢ –ü–æ–ø—Ä–æ—Å–∏—Ç—å –∫–æ–ª–ª–µ–≥—É –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥\n"
        f"‚Ä¢ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É: <code>/get_code @{owner_username}</code>"
    )
    
    if suggestions:
        message += "\n\nüí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:\n"
        for suggestion in suggestions:
            message += f"‚Ä¢ {suggestion}\n"
    
    return message


def format_error_message(
    error_type: str,
    details: Optional[str] = None,
    suggestions: Optional[List[str]] = None
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏.
    
    Args:
        error_type: –¢–∏–ø –æ—à–∏–±–∫–∏ ('connection', 'permission', 'not_found', 'validation')
        details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
        suggestions: –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    """
    error_messages = {
        'connection': (
            "‚ùå <b>–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø–æ—á—Ç–µ!</b>\n\n"
            "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
            "‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É\n"
            "‚Ä¢ –ò–∑–º–µ–Ω–∏–ª—Å—è –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n"
            "‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —É –ø–æ—á—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞\n"
        ),
        'permission': (
            "üîí <b>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω!</b>\n\n"
            "–£ —Ç–µ–±—è –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ.\n"
        ),
        'not_found': (
            "‚ùå <b>–ù–µ –Ω–∞–π–¥–µ–Ω–æ!</b>\n\n"
            "–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω.\n"
        ),
        'validation': (
            "‚ùå <b>–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏!</b>\n\n"
            "–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.\n"
        ),
        'generic': (
            "‚ùå <b>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</b>\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.\n"
        )
    }
    
    message = error_messages.get(error_type, error_messages['generic'])
    
    if details:
        message += f"\nüìù –î–µ—Ç–∞–ª–∏: {details}\n"
    
    if suggestions:
        message += "\nüí° –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:\n"
        for suggestion in suggestions:
            message += f"‚Ä¢ {suggestion}\n"
    
    return message


def format_registration_success(
    email: str,
    provider: str,
    username: str
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
    
    Args:
        email: Email –∞–¥—Ä–µ—Å
        provider: –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ—á—Ç—ã
        username: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    return (
        f"‚úÖ <b>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</b>\n\n"
        f"üìß Email: <code>{email}</code>\n"
        f"üè¢ –ü—Ä–æ–≤–∞–π–¥–µ—Ä: {provider}\n\n"
        f"–¢–µ–ø–µ—Ä—å –∫–æ–ª–ª–µ–≥–∏ –º–æ–≥—É—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–≤–æ–∏–º –∫–æ–¥–∞–º —á–µ—Ä–µ–∑:\n"
        f"<code>/request_access @{username}</code>\n\n"
        f"–ê —Ç—ã –º–æ–∂–µ—à—å –ø–æ–ª—É—á–∞—Ç—å –∫–æ–¥—ã –∫–æ–ª–ª–µ–≥ (—Å –∏—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è):\n"
        f"<code>/get_code @username</code>"
    )


def format_permission_request(
    requester_username: str,
    requester_name: str,
    requester_email: str
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Å—Ç—É–ø.
    
    Args:
        requester_username: Username –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ
        requester_name: –ò–º—è –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ
        requester_email: Email –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    return (
        f"üîî <b>–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–≤–æ–∏–º 2FA –∫–æ–¥–∞–º</b>\n\n"
        f"üë§ –û—Ç: @{requester_username} ({requester_name})\n"
        f"üìß Email: {requester_email}\n\n"
        f"–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø?"
    )


def format_permission_granted(
    requester_username: str,
    owner_username: str,
    owner_email: str
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ.
    
    Args:
        requester_username: Username –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ
        owner_username: Username –≤–ª–∞–¥–µ–ª—å—Ü–∞
        owner_email: Email –≤–ª–∞–¥–µ–ª—å—Ü–∞
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    return (
        f"‚úÖ <b>–î–æ—Å—Ç—É–ø –ø–æ–ª—É—á–µ–Ω!</b>\n\n"
        f"@{owner_username} —Ä–∞–∑—Ä–µ—à–∏–ª –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–∏–º –∫–æ–¥–∞–º.\n\n"
        f"–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥:\n"
        f"<code>/get_code @{owner_username}</code>\n"
        f"<code>/get_code {owner_email}</code>"
    )


def format_progress_message(stage: str, details: Optional[str] = None) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    
    Args:
        stage: –≠—Ç–∞–ø –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ('searching', 'connecting', 'fetching', 'parsing')
        details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    stage_messages = {
        'searching': "üîç –ò—â—É –∫–æ–¥ –≤ –ø–æ—á—Ç–µ...",
        'connecting': "üîå –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ –ø–æ—á—Ç–µ...",
        'fetching': "üì• –ü–æ–ª—É—á–∞—é –ø–∏—Å—å–º–∞...",
        'parsing': "üîé –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –ø–∏—Å—å–º–∞...",
        'found': "‚úÖ –ö–æ–¥ –Ω–∞–π–¥–µ–Ω!"
    }
    
    message = stage_messages.get(stage, "‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...")
    
    if details:
        message += f"\n{details}"
    
    return message


def format_tips_message() -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª–µ–∑–Ω—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏.
    
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å–æ–≤–µ—Ç–∞–º–∏
    """
    return (
        "üí° <b>–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã</b>\n\n"
        "üîê <b>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</b>\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å\n"
        "‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π, –∫–æ–º—É —Ç—ã –¥–∞–ª –¥–æ—Å—Ç—É–ø\n"
        "‚Ä¢ –û—Ç–∑—ã–≤–∞–π –¥–æ—Å—Ç—É–ø —É –±—ã–≤—à–∏—Ö –∫–æ–ª–ª–µ–≥\n\n"
        "‚ö° <b>–°–∫–æ—Ä–æ—Å—Ç—å:</b>\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n"
        "‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–ª–ª–µ–≥ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π /menu –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n"
        "‚ùì <b>–ü—Ä–æ–±–ª–µ–º—ã:</b>\n"
        "‚Ä¢ –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è, –ø–æ–ø—Ä–æ—Å–∏ –∫–æ–ª–ª–µ–≥—É –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π\n"
        "‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—á—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π /check_email\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π /help –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å–ø—Ä–∞–≤–∫–∏"
    )


def format_help_section(section: str) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª —Å–ø—Ä–∞–≤–∫–∏.
    
    Args:
        section: –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ ('register', 'get_code', 'permissions', 'faq', 'tips')
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞
    """
    sections = {
        'register': (
            "üìß <b>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</b>\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π /register —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é –ø–æ—á—Ç—É.\n\n"
            "<b>–ß—Ç–æ –Ω—É–∂–Ω–æ:</b>\n"
            "‚Ä¢ Email –∞–¥—Ä–µ—Å\n"
            "‚Ä¢ –ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ù–ï –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å!)\n\n"
            "<b>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</b>\n"
            "üìß Gmail: https://myaccount.google.com/apppasswords\n"
            "üìß Yandex: https://id.yandex.ru/security/app-passwords\n"
            "üìß Mail.ru: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–∞—Ä–æ–ª—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å\n\n"
            "<b>–§–æ—Ä–º–∞—Ç:</b>\n"
            "<code>email@example.com –ø–∞—Ä–æ–ª—å_–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</code>"
        ),
        'get_code': (
            "üîê <b>–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–æ–≤</b>\n\n"
            "–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ–ª—É—á–∏—Ç—å 2FA –∫–æ–¥:\n\n"
            "<b>1. –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:</b>\n"
            "<code>/get_code @username</code>\n"
            "<code>/get_code email@example.com</code>\n\n"
            "<b>2. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:</b>\n"
            "<code>/get_code</code> - –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏ –∏–∑ —Å–ø–∏—Å–∫–∞\n\n"
            "<b>3. –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±:</b>\n"
            "–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏: <code>@username</code>\n\n"
            "<b>–í–∞–∂–Ω–æ:</b>\n"
            "‚Ä¢ –°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ /request_access\n"
            "‚Ä¢ –ö–æ–¥—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã —Ç–æ–ª—å–∫–æ 10 –º–∏–Ω—É—Ç"
        ),
        'permissions': (
            "üë• <b>–†–∞–∑—Ä–µ—à–µ–Ω–∏—è</b>\n\n"
            "<b>–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø:</b>\n"
            "<code>/request_access @username</code>\n"
            "<code>/request_access email@example.com</code>\n\n"
            "<b>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:</b>\n"
            "<code>/my_permissions</code>\n\n"
            "<b>–û—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø:</b>\n"
            "<code>/revoke @username</code>\n\n"
            "<b>–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:</b>\n"
            "<code>/pending_requests</code>"
        ),
        'faq': (
            "‚ùì <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</b>\n\n"
            "<b>Q: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏ —ç—Ç–æ?</b>\n"
            "A: –î–∞, –ø–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –¢–æ–ª—å–∫–æ —Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å –¥–æ—Å—Ç—É–ø.\n\n"
            "<b>Q: –ß—Ç–æ –µ—Å–ª–∏ —è –∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?</b>\n"
            "A: –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è —á–µ—Ä–µ–∑ /register\n\n"
            "<b>Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å?</b>\n"
            "A: –ù–µ—Ç! –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.\n\n"
            "<b>Q: –ö–æ–¥ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å?</b>\n"
            "A: –ü–æ–ø—Ä–æ—Å–∏ –∫–æ–ª–ª–µ–≥—É –∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥, –ø–æ–¥–æ–∂–¥–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞."
        ),
        'tips': format_tips_message()
    }
    
    return sections.get(section, "–†–∞–∑–¥–µ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")


def format_user_list_message(
    users: List[Dict],
    action: str = "get_code",
    page: int = 0,
    total_pages: int = 1
) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    
    Args:
        users: –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        action: –î–µ–π—Å—Ç–≤–∏–µ ('get_code', 'request_access')
        page: –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        total_pages: –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    if action == "get_code":
        title = "üîê <b>–í—ã–±–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞:</b>"
    elif action == "request_access":
        title = "‚ûï <b>–í—ã–±–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞:</b>"
    else:
        title = "üë• <b>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</b>"
    
    message = f"{title}\n\n"
    
    if not users:
        message += "üì≠ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        return message
    
    for i, user in enumerate(users, start=1):
        username = user.get('username', 'unknown')
        email = user.get('email', 'N/A')
        message += f"{i}. @{username} ({email})\n"
    
    if total_pages > 1:
        message += f"\nüìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ {page + 1} –∏–∑ {total_pages}"
    
    return message
